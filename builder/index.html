<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Character Builder</title>
  <link rel="preload" href="/builder/wizard.js" as="script">
  <link rel="stylesheet" href="/css/theme.css" />
  <script src="/js/loader.js" defer></script>
  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: var(--color-bg-alt);
      color: var(--color-text);
    }
    header {
      padding: 1rem 1.5rem 0.75rem;
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, var(--scrim-strong) 0%, var(--scrim-soft) 65%, transparent 100%);
      backdrop-filter: blur(20px);
      z-index: 3;
    }
    h1 {
      margin: 0;
      font-size: 1.35rem;
    }
    #step-indicator {
      margin: 0.35rem 0 0;
      font-size: 0.9rem;
      color: var(--color-text-muted);
    }
    .pack-meta {
      margin: 0.35rem 0 0;
      font-size: 0.85rem;
      color: var(--color-text-muted);
    }
    main {
      flex: 1;
      padding: 1rem 1.5rem 7rem;
      display: grid;
      gap: 1.25rem;
    }
    form.grid {
      display: grid;
      gap: 1.25rem;
    }
    section.step {
      display: none;
      flex-direction: column;
      gap: 0.75rem;
    }
    section.step.active {
      display: flex;
    }
    .step h2 {
      margin: 0 0 0.5rem;
      font-size: 1.1rem;
    }
    label {
      display: grid;
      gap: 0.4rem;
      font-size: 0.9rem;
      color: var(--color-text-muted);
    }
    input,
    select,
    textarea {
      padding: 0.75rem 0.8rem;
      border-radius: 0.8rem;
      border: 1px solid var(--color-border);
      background: var(--color-surface);
      color: var(--color-text);
      font-size: 1rem;
      transition: border-color 160ms ease, box-shadow 160ms ease, background 160ms ease;
    }
    input::placeholder,
    textarea::placeholder {
      color: var(--color-text-subtle);
    }
    input:focus-visible,
    select:focus-visible,
    textarea:focus-visible {
      border-color: var(--color-accent);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-accent) 30%, transparent);
      background: var(--color-surface-raised);
    }
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    .grid {
      display: grid;
      gap: 0.75rem;
    }
    .grid.two {
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
    .ability {
      display: grid;
      gap: 0.4rem;
      padding: 0.75rem;
      border-radius: 0.8rem;
      background: var(--color-accent-soft);
      border: 1px solid var(--color-accent-border);
      color: var(--color-text);
    }
    .ability span {
      font-size: 0.85rem;
      color: var(--color-text-subtle);
    }
    .sticky-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      padding: 0.75rem calc(env(safe-area-inset-left) + 1rem) calc(env(safe-area-inset-bottom) + 1rem);
      gap: 0.75rem;
      background: linear-gradient(180deg, var(--scrim-soft) 0%, var(--scrim-strong) 80%);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--color-border);
      z-index: 5;
    }
    .sticky-nav button {
      flex: 1;
      padding: 0.85rem 1rem;
      border-radius: 0.9rem;
      border: 1px solid transparent;
      font-weight: 600;
      font-size: 0.95rem;
      transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
    }
    .sticky-nav button.primary {
      background: var(--color-accent);
      color: var(--color-accent-contrast);
    }
    .sticky-nav button.secondary {
      background: var(--color-surface);
      border-color: var(--color-border);
      color: var(--color-text);
    }
    .sticky-nav button.ghost {
      flex: 0.75;
      background: transparent;
      border-color: var(--color-border);
      color: var(--color-text-muted);
    }
    .sticky-nav button:hover,
    .sticky-nav button:focus-visible {
      transform: translateY(-2px);
    }
    .sticky-nav button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    #summary-panel {
      position: fixed;
      inset: auto 0 calc(env(safe-area-inset-bottom) + 4.5rem);
      margin: 0 1rem;
      background: var(--color-surface-raised);
      border: 1px solid var(--color-border-strong);
      border-radius: 1rem;
      padding: 1rem 1.25rem 1.25rem;
      max-height: 45vh;
      overflow-y: auto;
      transform: translateY(110%);
      transition: transform 220ms ease;
      z-index: 4;
      box-shadow: var(--shadow-floating);
      pointer-events: none;
      visibility: hidden;
    }
    #summary-panel.visible {
      transform: translateY(0);
      pointer-events: auto;
      visibility: visible;
    }
    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }
    .summary-header h3 {
      margin: 0;
      font-size: 1rem;
    }
    .panel-close {
      background: transparent;
      border: 1px solid var(--color-border);
      color: var(--color-text);
      border-radius: 999px;
      width: 2.25rem;
      height: 2.25rem;
      display: grid;
      place-items: center;
      font-size: 1.1rem;
    }
    #summary-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.65rem;
    }
    #summary-list li {
      background: var(--color-surface);
      border-radius: 0.75rem;
      padding: 0.6rem 0.75rem;
      border: 1px solid var(--color-border);
      font-size: 0.92rem;
    }
    .summary-label {
      display: block;
      font-size: 0.8rem;
      color: var(--color-text-muted);
    }
    .summary-value {
      display: block;
      margin-top: 0.35rem;
      color: var(--color-text);
    }
    .legal-link {
      padding: 0.75rem 1.5rem;
      font-size: 0.8rem;
      color: var(--color-text-subtle);
      text-align: center;
    }
    .legal-link a {
      color: inherit;
    }
    .support-text {
      color: var(--color-text-muted);
      font-size: 0.95rem;
      margin: 0 0 0.75rem;
    }
    .fine-print {
      color: var(--color-text-subtle);
      font-size: 0.8rem;
      display: block;
      margin-top: 0.5rem;
    }
    .align-start {
      justify-self: flex-start;
    }
    @media (max-width: 640px) {
      .grid.two {
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      }
    }
  </style>
</head>
<body data-accent="emerald">
  <a class="skip-link" href="#builder-main">Skip to builder form</a>
  <header>
    <h1>Character Builder</h1>
    <p id="step-indicator" role="status" aria-live="polite">Step 1 of 7 · Identity</p>
    <p id="builder-pack-meta" class="pack-meta" aria-live="polite">Loading System Reference Document…</p>
  </header>
  <main id="builder-main" role="main" tabindex="-1">
    <form id="builder-form" class="grid" novalidate>
      <section class="step active" data-step="identity">
        <h2>Identity</h2>
        <label>Character name
          <input type="text" name="name" placeholder="Ailith Stormbreath" required />
        </label>
        <label>Background
          <input type="text" name="background" placeholder="Wanderer" list="background-options" />
        </label>
        <label>Alignment
          <select name="alignment">
            <option value="">Select alignment</option>
            <option>Lawful Good</option>
            <option>Neutral Good</option>
            <option>Chaotic Good</option>
            <option>Lawful Neutral</option>
            <option>True Neutral</option>
            <option>Chaotic Neutral</option>
            <option>Lawful Evil</option>
            <option>Neutral Evil</option>
            <option>Chaotic Evil</option>
          </select>
        </label>
      </section>
      <section class="step" data-step="classLevel">
        <h2>Class &amp; Level</h2>
        <div class="grid two">
          <label>Primary class
            <select name="class">
              <option value="">Choose a class</option>
            </select>
          </label>
          <label>Level
            <input type="number" min="1" max="20" name="level" value="1" />
          </label>
        </div>
        <label>Subclass focus
          <input type="text" name="subclass" placeholder="Circle of Stars" />
        </label>
      </section>
      <section class="step" data-step="abilities">
        <h2>Ability Scores</h2>
        <div class="grid two">
          <label>Generation method
            <select name="abilityMethod">
              <option>Standard Array</option>
              <option>Point Buy</option>
              <option>Manual Entry</option>
            </select>
          </label>
          <label>Total score pool
            <input type="number" name="scorePool" value="27" />
          </label>
        </div>
        <div class="grid two" id="abilities-grid">
          <!-- ability inputs inserted by wizard.js -->
        </div>
      </section>
      <section class="step" data-step="feats">
        <h2>Feats &amp; Talents</h2>
        <label>Signature feat
          <input type="text" name="signatureFeat" placeholder="Alert" list="feat-options" />
        </label>
        <label>Bonus feats
          <textarea name="bonusFeats" placeholder="Great Weapon Master, Mage Slayer"></textarea>
        </label>
      </section>
      <section class="step" data-step="equipment">
        <h2>Equipment</h2>
        <label>Weapon loadout
          <textarea name="weapons" placeholder="Longsword, hand crossbow"></textarea>
        </label>
        <label>Armor &amp; defenses
          <textarea name="armor" placeholder="Half-plate, cloak of protection"></textarea>
        </label>
        <label>Adventuring gear
          <input type="text" name="gear" placeholder="Explorer's pack, sending stones" list="item-options" />
        </label>
      </section>
      <section class="step" data-step="familiar">
        <h2>Companions &amp; Familiars</h2>
        <label>Companion name
          <input type="text" name="familiarName" placeholder="Nimbus" />
        </label>
        <label>Creature type
          <select name="familiarType">
            <option value="">Select a creature</option>
          </select>
        </label>
        <label>Notes
          <textarea name="familiarNotes" placeholder="Track hit points, special abilities, and personality"></textarea>
        </label>
      </section>
      <section class="step" data-step="finalize" id="finalize">
        <h2>Finalize &amp; Export</h2>
        <p class="support-text">Review your summary, generate a printable sheet, or export your data for VTT import.</p>
        <div class="grid">
          <button type="button" data-action="print" class="ghost align-start">Print builder sheet</button>
          <button type="button" data-action="export" class="ghost align-start">Export JSON</button>
        </div>
        <small class="fine-print">Your progress is saved automatically.</small>
      </section>
    </form>
  </main>
  <datalist id="background-options"></datalist>
  <datalist id="feat-options"></datalist>
  <datalist id="item-options"></datalist>
  <p class="legal-link">
    <a href="/LEGAL/NOTICE.txt" target="_blank" rel="noopener noreferrer">SRD 5.1 licensing notice</a>
  </p>
  <aside id="summary-panel" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="summary-title" tabindex="-1">
    <div class="summary-header">
      <h3 id="summary-title">Adventure summary</h3>
      <button type="button" class="panel-close" data-action="close-summary">
        <span aria-hidden="true">×</span>
        <span class="sr-only">Close summary</span>
      </button>
    </div>
    <ul id="summary-list"></ul>
  </aside>
  <nav class="sticky-nav" aria-label="Wizard navigation">
    <button type="button" class="secondary" id="prev-step">Back</button>
    <button
      type="button"
      class="ghost"
      id="toggle-summary"
      aria-controls="summary-panel"
      aria-expanded="false"
      aria-haspopup="dialog"
    >Summary</button>
    <button type="button" class="primary" id="next-step">Next</button>
  </nav>
  <script src="/builder/wizard.js" type="module" defer></script>
  <script src="/builder/summary.js" type="module" defer></script>
</body>
</html>
